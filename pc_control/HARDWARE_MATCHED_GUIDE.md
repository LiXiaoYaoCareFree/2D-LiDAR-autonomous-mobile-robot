# å®Œå…¨åŒ¹é…ç¡¬ä»¶ä»£ç çš„è“ç‰™æŽ§åˆ¶ç¨‹åº

## ðŸŽ¯ ç¨‹åºç‰¹ç‚¹

è¿™ä¸ªç¨‹åº**å®Œå…¨åŒ¹é…**ä½ çš„`hardware.c`ä»£ç ï¼ŒåŒæ—¶å€Ÿé‰´äº†`bluetooth2.py`çš„ä¼˜ç§€æ˜¾ç¤ºæ–¹å¼ã€‚

### ðŸ“‹ æ•°æ®æ ¼å¼å®Œå…¨åŒ¹é…

#### 1. **æŽ§åˆ¶å‘½ä»¤æ ¼å¼** - å®Œå…¨åŒ¹é…hardware.c
```c
// hardware.cä¸­çš„å‘½ä»¤å¤„ç†
if (bluetooth_rx_data >= '0' && bluetooth_rx_data <= '5') {
    target_direction = bluetooth_rx_data - '0';
}
```

**Pythonç¨‹åºå¯¹åº”**ï¼š
```python
self.commands = {
    'STOP': '0',      # DIR_STOP
    'FORWARD': '1',   # DIR_FORWARD  
    'BACKWARD': '2',  # DIR_BACKWARD
    'LEFT': '3',      # DIR_LEFT
    'RIGHT': '4',     # DIR_RIGHT
    'UTURN': '5'      # DIR_UTURN
}
```

#### 2. **æ¿€å…‰é›·è¾¾æ•°æ®æ ¼å¼** - åŒ¹é…hardware.cçš„SendLidarToBluetooth
```c
// hardware.cä¸­çš„é›·è¾¾æ•°æ®å‘é€
void SendLidarToBluetooth(float angle, float distance, uint8_t quality) {
    char buffer[32];
    int len = snprintf(buffer, sizeof(buffer), "A:%.2f,D:%.2f,Q:%d\n", angle, distance, quality);
    HAL_UART_Transmit(&huart1, (uint8_t*)buffer, len, 100);
}
```

**Pythonç¨‹åºè§£æž**ï¼š
```python
# è§£æžé›·è¾¾æ•°æ®ï¼ˆæ ¼å¼ï¼šA:123.45, D:0.678, Q:100ï¼‰
radar_matches = re.findall(r'A:([-+]?\d*\.\d+),\s*D:([-+]?\d*\.\d+),\s*Q:(\d+)', self.data_buffer)
```

#### 3. **ç”µæœºæ•°æ®æ ¼å¼** - åŒ¹é…hardware.cçš„ç”µæœºæ•°æ®
```c
// hardware.cä¸­çš„ç”µæœºæ•°æ®å‘é€
snprintf(uart_buf, sizeof(uart_buf), "MotorA:%.1f,RPMB:%.1f\n", rpmA, rpmB);
HAL_UART_Transmit(&huart1, (uint8_t *)uart_buf, strlen(uart_buf), 100);
```

**Pythonç¨‹åºè§£æž**ï¼š
```python
# è§£æžç”µæœºæ•°æ®ï¼ˆæ ¼å¼ï¼šMotorA:123.45,RPMB:67.89ï¼‰
motor_matches = re.findall(r'MotorA:([-+]?\d*\.\d+),RPMB:([-+]?\d*\.\d+)', self.data_buffer)
```

#### 4. **IMUæ•°æ®æ ¼å¼** - åŒ¹é…hardware.cçš„MPU6500æ•°æ®
```c
// hardware.cä¸­çš„IMUæ•°æ®å‘é€
snprintf(uart_buf, sizeof(uart_buf),
    "AccX:%.2f,AccY:%.2f,AccZ:%.2f,GyroX:%.2f,GyroY:%.2f,GyroZ:%.2f\n",
    mpu_data.accel_x, mpu_data.accel_y, mpu_data.accel_z,
    mpu_data.gyro_x, mpu_data.gyro_y, mpu_data.gyro_z);
```

**Pythonç¨‹åºè§£æž**ï¼š
```python
# è§£æžIMUæ•°æ®ï¼ˆæ ¼å¼ï¼šAccX:1.23,AccY:4.56,AccZ:7.89,GyroX:0.12,GyroY:0.34,GyroZ:0.56ï¼‰
imu_matches = re.findall(r'AccX:([-+]?\d*\.\d+),AccY:([-+]?\d*\.\d+),AccZ:([-+]?\d*\.\d+),GyroX:([-+]?\d*\.\d+),GyroY:([-+]?\d*\.\d+),GyroZ:([-+]?\d*\.\d+)', self.data_buffer)
```

### ðŸŽ¨ æ˜¾ç¤ºæ–¹å¼å€Ÿé‰´bluetooth2.py

#### 1. **æžåæ ‡é›·è¾¾æ˜¾ç¤º**
- å®Œå…¨å€Ÿé‰´`bluetooth2.py`çš„æžåæ ‡æ˜¾ç¤ºæ–¹å¼
- æ”¯æŒé¼ æ ‡æ»šè½®ç¼©æ”¾
- å®žæ—¶æ›´æ–°é›·è¾¾æ‰«æç‚¹

#### 2. **ä¸‰è½´è§’åº¦æ˜¾ç¤º**
- å®žæ—¶æ˜¾ç¤ºrollã€pitchã€yawè§’åº¦
- ä¸Ž`bluetooth2.py`çš„æ˜¾ç¤ºæ–¹å¼ä¸€è‡´

#### 3. **æ•°æ®è¿‡æ»¤å’Œå¼‚å¸¸æ£€æµ‹**
- å€Ÿé‰´`bluetooth2.py`çš„å¼‚å¸¸å€¼æ£€æµ‹ç®—æ³•
- è´¨é‡è¿‡æ»¤å’Œè·ç¦»èŒƒå›´æ£€æŸ¥

## ðŸš€ ä½¿ç”¨æ–¹æ³•

### 1. **å¯åŠ¨ç¨‹åº**
```bash
cd pc_control
python start_hardware_matched.py
```

### 2. **è¿žæŽ¥è®¾ç½®**
- é€‰æ‹©ä¸²å£å·ï¼ˆå¦‚COM3ï¼‰
- æ³¢ç‰¹çŽ‡115200ï¼ˆåŒ¹é…hardware.cï¼‰
- ç‚¹å‡»"Connect"

### 3. **æŽ§åˆ¶å°è½¦**
- **é”®ç›˜æŽ§åˆ¶**ï¼šæ–¹å‘é”® + ç©ºæ ¼
- **æŒ‰é’®æŽ§åˆ¶**ï¼šç‚¹å‡»ç•Œé¢æŒ‰é’®
- **å‘½ä»¤æ ¼å¼**ï¼šå®Œå…¨åŒ¹é…hardware.c

### 4. **æ•°æ®æ˜¾ç¤º**
- **é›·è¾¾æ‰«æ**ï¼šæžåæ ‡å®žæ—¶æ˜¾ç¤º
- **ä¸‰è½´è§’åº¦**ï¼šrollã€pitchã€yaw
- **ç”µæœºæ•°æ®**ï¼šrpmAã€rpmB
- **IMUæ•°æ®**ï¼šåŠ é€Ÿåº¦å’Œé™€èžºä»ª

## ðŸ”§ æŠ€æœ¯ç‰¹æ€§

### 1. **æ•°æ®è§£æžå®Œå…¨åŒ¹é…**
- æ¿€å…‰é›·è¾¾ï¼š`A:è§’åº¦,D:è·ç¦»,Q:è´¨é‡`
- ç”µæœºæ•°æ®ï¼š`MotorA:RPM,RPMB:RPM`
- IMUæ•°æ®ï¼š`AccX:å€¼,AccY:å€¼,AccZ:å€¼,GyroX:å€¼,GyroY:å€¼,GyroZ:å€¼`

### 2. **æŽ§åˆ¶å‘½ä»¤å®Œå…¨åŒ¹é…**
- å‘é€å•å­—ç¬¦å‘½ä»¤ï¼š'0'-'5'
- å®Œå…¨åŒ¹é…hardware.cçš„å‘½ä»¤å¤„ç†é€»è¾‘

### 3. **æ˜¾ç¤ºæ–¹å¼å€Ÿé‰´bluetooth2.py**
- æžåæ ‡é›·è¾¾æ˜¾ç¤º
- é¼ æ ‡æ»šè½®ç¼©æ”¾
- å¼‚å¸¸å€¼æ£€æµ‹å’Œè¿‡æ»¤
- å®žæ—¶æ•°æ®æ›´æ–°

### 4. **çº¿ç¨‹å®‰å…¨è®¾è®¡**
- ä¸²å£è¯»å–çº¿ç¨‹
- GUIæ›´æ–°çº¿ç¨‹
- æ•°æ®è§£æžçº¿ç¨‹

## ðŸ“Š åŠŸèƒ½å¯¹æ¯”

| åŠŸèƒ½ | hardware.c | æœ¬ç¨‹åº | bluetooth2.py |
|------|------------|--------|----------------|
| **æŽ§åˆ¶å‘½ä»¤** | âœ… å•å­—ç¬¦ | âœ… å®Œå…¨åŒ¹é… | âŒ æ—  |
| **é›·è¾¾æ•°æ®** | âœ… å‘é€ | âœ… è§£æžæ˜¾ç¤º | âœ… æ˜¾ç¤º |
| **ç”µæœºæ•°æ®** | âœ… å‘é€ | âœ… è§£æžæ˜¾ç¤º | âŒ æ—  |
| **IMUæ•°æ®** | âœ… å‘é€ | âœ… è§£æžæ˜¾ç¤º | âœ… æ˜¾ç¤º |
| **æžåæ ‡æ˜¾ç¤º** | âŒ æ—  | âœ… å€Ÿé‰´ | âœ… åŽŸç”Ÿ |
| **é”®ç›˜æŽ§åˆ¶** | âŒ æ—  | âœ… æ”¯æŒ | âŒ æ—  |

## ðŸŽ¯ ä¼˜åŠ¿æ€»ç»“

1. **å®Œå…¨å…¼å®¹**ï¼šä¸Žhardware.cçš„æ•°æ®æ ¼å¼100%åŒ¹é…
2. **æ˜¾ç¤ºä¼˜ç§€**ï¼šå€Ÿé‰´bluetooth2.pyçš„ä¼˜ç§€æ˜¾ç¤ºæ–¹å¼
3. **åŠŸèƒ½å®Œæ•´**ï¼šæ”¯æŒæ‰€æœ‰hardware.cçš„åŠŸèƒ½
4. **æ˜“äºŽä½¿ç”¨**ï¼šå›¾å½¢ç•Œé¢ + é”®ç›˜æŽ§åˆ¶
5. **å®žæ—¶æ€§å¥½**ï¼š50msæ›´æ–°é¢‘çŽ‡

## ðŸ” æŠ€æœ¯ç»†èŠ‚

### 1. **æ•°æ®æµå¤„ç†**
```
hardware.c â†’ ä¸²å£ â†’ Pythonç¨‹åº â†’ è§£æž â†’ æ˜¾ç¤º
```

### 2. **å‘½ä»¤æµå¤„ç†**
```
é”®ç›˜/æŒ‰é’® â†’ Pythonç¨‹åº â†’ ä¸²å£ â†’ hardware.c â†’ ç”µæœºæŽ§åˆ¶
```

### 3. **æ˜¾ç¤ºæ›´æ–°**
```
æ•°æ®è§£æž â†’ é›·è¾¾ç‚¹æ›´æ–° â†’ æžåæ ‡æ˜¾ç¤º â†’ è§’åº¦æ–‡æœ¬æ›´æ–°
```

è¿™ä¸ªç¨‹åºå®Œç¾Žç»“åˆäº†ä½ çš„hardware.cä»£ç å’Œbluetooth2.pyçš„æ˜¾ç¤ºä¼˜åŠ¿ï¼Œæä¾›äº†ä¸€ä¸ªåŠŸèƒ½å®Œæ•´ã€æ˜“äºŽä½¿ç”¨çš„è“ç‰™æŽ§åˆ¶ç•Œé¢ï¼
